# Проблемы, обнаруженные при проверке C4 и C5 в браузере

**Дата**: 2025-01-27  
**Статус**: In Progress  
**Начало исправления**: 2025-12-01

## Обнаруженные проблемы

### Проблема 1: Completed задачи не отображаются при фильтре "Completed"

**Описание**:
- В API есть completed задача (id=3, "Test Completed Task")
- При активации фильтра "Completed" список задач пустой
- При фильтре "All" отображаются только active задачи

**Причина**:
- Задачи загружаются при монтировании компонента (`onMounted`)
- После изменения статуса задачи через API (например, через curl), фронтенд не обновляется автоматически
- Нужно либо перезагрузить страницу, либо добавить автоматическое обновление после изменения статуса

**Воспроизведение**:
1. Открыть приложение в браузере
2. Создать задачу через API: `curl -X POST http://localhost:8080/api/todos -H "Content-Type: application/json" -d '{"title":"Test"}'`
3. Изменить статус на completed: `curl -X PATCH http://localhost:8080/api/todos/3/status`
4. В браузере переключить фильтр на "Completed"
5. Список пустой, хотя в API есть completed задача

**Решение**:
- Добавить автоматическое обновление списка задач после изменения статуса
- Или добавить кнопку "Обновить" для ручного обновления
- Или использовать WebSocket для real-time обновлений (более сложное решение)

### Проблема 2: Счетчик активных задач не обновляется при изменении статуса через API

**Описание**:
- Счетчик показывает "1 item left" даже когда есть 2 active задачи
- Это происходит потому, что фронтенд не знает об изменениях, сделанных через API

**Причина**:
- Та же причина, что и в Проблеме 1 - отсутствие автоматического обновления

**Решение**:
- Решить вместе с Проблемой 1

## Что работает правильно

✅ Фильтры переключаются корректно (All, Active, Completed)  
✅ Счетчик отображается в футере  
✅ UI фильтров работает (кнопки кликабельны, активный фильтр выделен)  
✅ Фильтрация работает для задач, которые уже загружены во фронтенде  
✅ Счетчик корректно считает активные задачи из загруженного списка

## Реализованное решение

### Добавлена кнопка обновления

**Изменения в `TodoList.vue`**:
1. ✅ Добавлена кнопка обновления (↻) в футере рядом с кнопкой "Clear completed"
2. ✅ Кнопка вызывает метод `loadTodos()` для перезагрузки списка задач
3. ✅ Метод `refresh` экспортирован через `defineExpose` для использования из родительского компонента
4. ✅ Кнопка имеет hover-эффект с поворотом на 180°
5. ✅ Кнопка отключается во время загрузки (`isLoading`)

**Код изменений**:
```vue
<button
  class="refresh-btn"
  @click="loadTodos"
  :disabled="isLoading"
  title="Обновить список задач"
>
  ↻
</button>
```

**Стили**:
- Кнопка имеет размер 32x32px
- При hover поворачивается на 180° (анимация)
- Цвет и стиль соответствуют остальным кнопкам футера

## Рекомендации (для будущих улучшений)

1. ✅ **Краткосрочное решение**: Добавить кнопку "Обновить" для ручного обновления списка задач - **РЕАЛИЗОВАНО**
2. **Среднесрочное решение**: Автоматически обновлять список после каждого изменения (polling или refetch после мутаций)
3. **Долгосрочное решение**: Использовать WebSocket для real-time синхронизации (если требуется)

## Приоритет

**Medium** - Функциональность работает, но есть UX проблема: пользователь не видит изменения, сделанные извне (например, другим устройством или через API напрямую).

## Выполненные изменения

### 2025-12-01

1. ✅ Добавлена кнопка обновления (↻) в футере `TodoList.vue`
2. ✅ Кнопка вызывает `loadTodos()` для перезагрузки списка задач
3. ✅ Метод `refresh` экспортирован через `defineExpose` для внешнего использования
4. ✅ Добавлены стили для кнопки с hover-эффектом (поворот на 180°)
5. ✅ Кнопка отключается во время загрузки

### Тестирование

**Статус**: Требуется проверка в браузере после восстановления backend

**Проблемы окружения**:
- Backend контейнер не запускается (ошибка `php-fpm: not found`)
- Это отдельная проблема окружения, не связанная с изменениями C4_C5

**Что нужно проверить**:
1. Кнопка обновления видна в футере рядом с "Clear completed"
2. При клике на кнопку список задач обновляется
3. После обновления отображаются все задачи (включая completed)
4. Счетчик активных задач обновляется после обновления
5. Фильтр "Completed" показывает completed задачи после обновления

