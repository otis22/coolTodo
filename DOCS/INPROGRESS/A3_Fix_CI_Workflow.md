# Task A3-Fix-CI: Исправление ошибок в GitHub Actions CI workflow

**Статус**: Open (готово к выполнению)
**Начало**: 2025-11-29
**Приоритет**: High
**Оценка**: 0.5 дня

## Описание

Исправить оставшиеся ошибки в GitHub Actions CI workflow, связанные с нестандартной структурой проекта (Laravel в `backend/` директории). Основная проблема - отсутствие `package-lock.json` для npm ci.

## Проблемы

### Проблема: Отсутствует package-lock.json для npm ci

**Ошибка**:
```
npm error The `npm ci` command can only install with an existing package-lock.json or
npm error npm-shrinkwrap.json with lockfileVersion >= 1.
```

**Причина**:
- В CI workflow используется команда `npm ci` (строка 50), которая требует наличия `package-lock.json`
- Файл `package-lock.json` существует в `frontend/` и закоммичен в репозиторий
- Нужно убедиться, что `npm ci` работает корректно

**Решение**:
- Проверить, что `package-lock.json` закоммичен в репозиторий
- Убедиться, что `npm ci` в CI workflow работает корректно
- Если проблемы остаются, проверить версию npm и совместимость

## Зависимости

- [x] A2: Настроить CI пайплайн (Completed ✅)
- [x] A2-Fix: Устранение ошибок CI пайплайна (конфликт версий PHPStan) (Completed ✅)
- [x] A2-Fix-Artisan: Исправление пути к artisan в CI (Completed ✅)
- [ ] A4: Исправление путей .env в CI workflow (In Progress)

## Декомпозиция на подзадачи

Задача разбита на подзадачи согласно принципам декомпозиции проекта (атомарность, размер от 30 минут до 0.5 дня, упорядоченность по зависимостям).

| Подзадача ID | Описание | Приоритет | Оценка | Зависимости | Инструменты | Критерии приемки |
|--------------|----------|-----------|--------|-------------|-------------|------------------|
| A3.1 | Проверить package-lock.json и его совместимость | High | 30 мин | None | npm, git | package-lock.json существует, lockfileVersion >= 1, файл закоммичен | ✅ Completed |
| A3.2 | Протестировать npm ci локально | High | 30 мин | A3.1 | npm, frontend/ | npm ci выполняется без ошибок локально |
| A3.3 | Проверить npm ci в CI workflow | High | 30 мин | A3.2 | GitHub Actions | npm ci успешно выполняется в CI |
| A3.4 | Проверить все шаги CI workflow | High | 30 мин | A3.3 | GitHub Actions | Все шаги workflow выполняются успешно |

## План выполнения

### Подзадача A3.1: Проверить package-lock.json и его совместимость (30 мин) ✅

**Статус**: Completed ✅  
**Завершено**: 2025-01-27

**Цель**: Убедиться, что `package-lock.json` существует, закоммичен и совместим с `npm ci`.

**Шаги**:
- [x] Проверить наличие `package-lock.json` в `frontend/` директории
- [x] Убедиться, что файл закоммичен в репозиторий
- [x] Проверить версию `lockfileVersion` в `package-lock.json`
- [x] Убедиться, что версия совместима с `npm ci` (lockfileVersion >= 1)

**Результаты проверки**:
- ✅ `package-lock.json` существует в `frontend/` директории
- ✅ Файл закоммичен в репозиторий (проверено через `git ls-files`)
- ✅ `lockfileVersion = 3` в файле (совместим с npm ci, требуется >= 1)
- ✅ Версия совместима с используемой версией npm:
  - Локально: npm 10.8.2 (Node.js 20.19.6) - полностью поддерживает lockfileVersion 3
  - В CI: Node.js 20 (поставляется с npm 10.x) - полностью поддерживает lockfileVersion 3
- ✅ Проверка совместимости через `npm ci --dry-run --ignore-scripts` прошла успешно

**Критерии приемки**:
- ✅ `package-lock.json` существует в `frontend/`
- ✅ Файл закоммичен в репозиторий
- ✅ `lockfileVersion = 3` (>= 1, совместим)
- ✅ Версия совместима с используемой версией npm (npm 10.x поддерживает lockfileVersion 3)

### Подзадача A3.2: Протестировать npm ci локально (30 мин)

**Цель**: Убедиться, что `npm ci` работает корректно в локальном окружении.

**Шаги**:
- [ ] Перейти в `frontend/` директорию
- [ ] Удалить `node_modules` (если существует)
- [ ] Запустить `npm ci`
- [ ] Проверить, что команда выполняется без ошибок
- [ ] Убедиться, что зависимости установлены корректно

**Критерии приемки**:
- ✅ `npm ci` выполняется без ошибок
- ✅ Все зависимости установлены
- ✅ `node_modules` создан корректно

### Подзадача A3.3: Проверить npm ci в CI workflow (30 мин)

**Цель**: Убедиться, что `npm ci` работает в GitHub Actions CI.

**Шаги**:
- [ ] Запустить CI пайплайн через push или PR
- [ ] Проверить логи шага "Install Node dependencies"
- [ ] Убедиться, что `npm ci` выполняется успешно
- [ ] Проверить, что нет ошибок связанных с `package-lock.json`

**Критерии приемки**:
- ✅ CI пайплайн проходит шаг "Install Node dependencies"
- ✅ `npm ci` выполняется без ошибок в CI
- ✅ Нет ошибок связанных с отсутствием или несовместимостью `package-lock.json`

### Подзадача A3.4: Проверить все шаги CI workflow (30 мин)

**Цель**: Убедиться, что все шаги CI workflow выполняются успешно после исправлений.

**Шаги**:
- [ ] Проверить выполнение всех шагов workflow последовательно
- [ ] Убедиться, что тесты выполняются корректно
- [ ] Проверить, что сборка frontend работает
- [ ] Убедиться, что нет других ошибок в workflow

**Критерии приемки**:
- ✅ Все шаги CI workflow выполняются успешно
- ✅ Тесты выполняются корректно
- ✅ Сборка frontend работает
- ✅ Нет критических ошибок в workflow

## Критерии приемки

✅ `package-lock.json` существует и закоммичен в репозиторий
✅ `npm ci` успешно выполняется в CI workflow
✅ Все шаги CI пайплайна выполняются успешно
✅ Тесты выполняются корректно

## Заметки

- Проблемы с путями к `artisan` уже решены в задаче A2-Fix-Artisan
- Проблемы с путями к `.env` решаются в задаче A4
- Проблемы с путями в `composer.json` уже решены в задаче A2-Fix-Artisan

## Связанные задачи

- A4: Исправление путей .env в CI workflow (связанная задача)
- A2-Fix-Artisan: Исправление пути к artisan в CI (Completed ✅)
