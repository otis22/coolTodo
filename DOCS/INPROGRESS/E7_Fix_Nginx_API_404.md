# Task E7: Исправить 404 ошибки в nginx для API

**Статус**: Open  
**Приоритет**: High  
**Оценка**: 0.25 дня

## Описание

Nginx возвращает 404 для всех API запросов. Конфигурация nginx указывает на неправильный путь к Laravel приложению. Несоответствие путей между nginx конфигурацией и docker-compose volumes.

## Проблема

**Текущая ситуация**:
- Nginx конфигурация (`docker/nginx/default.conf`): `root /var/www/html/public;`
- Docker-compose монтирует: `./backend:/var/www/project/backend`
- Правильный путь должен быть: `/var/www/project/backend/public`
- Несоответствие путей приводит к 404 ошибкам

**Ошибка**:
```
GET http://localhost:8080/api/todos
→ 404 Not Found (nginx)
```

## Зависимости

- [x] A3: Настроить Docker окружение (Completed ✅)
- [ ] E6: Исправить перезапуск app контейнера (Open)

## Требования

### Цель

Создать системное решение для nginx конфигурации, которое работает в:
- **Dev окружении**: Правильные пути к Laravel приложению
- **Production**: Та же конфигурация или отдельный файл (если нужны отличия)

### Критерии приемки

✅ API endpoints доступны через nginx (http://localhost:8080/api/todos)  
✅ Nginx правильно проксирует запросы к PHP-FPM  
✅ Все API маршруты работают  
✅ Конфигурация универсальна для dev и production (или легко настраивается)

## Системное решение

### Анализ путей

**Docker-compose volumes**:
```yaml
nginx:
  volumes:
    - ./backend:/var/www/project/backend
```

**Правильный root для nginx**:
```
root /var/www/project/backend/public;
```

**FastCGI SCRIPT_FILENAME**:
Должен указывать на тот же путь: `/var/www/project/backend/public/index.php`

### Подход

1. Обновить `docker/nginx/default.conf` с правильными путями
2. Использовать переменные окружения или шаблонизацию, если нужны разные пути для dev/prod
3. Убедиться, что конфигурация работает одинаково в обоих окружениях

## План выполнения

### Шаг 1: Анализ проблемы
- [x] Проверить текущую конфигурацию nginx ✅
- [x] Проверить пути в docker-compose.yml ✅
- [x] Определить правильный путь к Laravel public ✅

### Шаг 2: Исправление конфигурации
- [ ] Обновить `root` в `docker/nginx/default.conf`: `/var/www/project/backend/public`
- [ ] Обновить `fastcgi_param SCRIPT_FILENAME` для правильного пути
- [ ] Убедиться, что `try_files` правильно настроен
- [ ] Проверить, что конфигурация работает для всех маршрутов (API, health check)

### Шаг 3: Тестирование
- [ ] Проверить API endpoints через nginx
- [ ] Проверить health check endpoint (`/up`)
- [ ] Проверить, что статические файлы (если есть) работают
- [ ] Убедиться, что ошибки 404 исправлены

### Шаг 4: Production готовность
- [ ] Определить, нужна ли отдельная конфигурация для production
- [ ] Если нужна - создать `docker/nginx/default.prod.conf` или использовать env переменные
- [ ] Документировать различия (если есть)

## Прогресс

Создано: 2025-01-27  
Обновлено: 2025-01-27 (системный анализ)

