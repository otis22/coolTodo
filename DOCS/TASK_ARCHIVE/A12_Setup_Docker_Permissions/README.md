# Task A12: Настроить права доступа в Docker контейнерах

## Summary

Настроены права доступа в Docker контейнерах для работы от имени пользователя хоста. Обновлен docker-compose.yml для использования Dockerfile.dev и Dockerfile.tools с настройкой `user: "${UID:-1000}:${GID:-1000}"`. Добавлен новый сервис `tools` для инструментов анализа. Это обеспечивает правильные права доступа к файлам, созданным в контейнере.

## Source Requirements

- `DOCS/AI/Execution_Guide/04_TODO_Workplan.md` - Task A12
- `DOCS/AI/Execution_Guide/07_Development_Environment.md` - Техническая спецификация прав доступа

## Objectives

1. Настроить контейнеры для работы от имени пользователя хоста
2. Обновить docker-compose.yml для использования Dockerfile.dev и Dockerfile.tools
3. Добавить сервис `tools` для инструментов анализа
4. Обеспечить правильные права доступа к файлам

## Dependencies

- A10: Создать Dockerfile.dev для разработки (Completed ✅)
- A11: Создать Dockerfile.tools для инструментов анализа (Completed ✅)

## In-Scope / Out of Scope

**In-Scope**:
- Обновление docker-compose.yml для использования Dockerfile.dev и Dockerfile.tools
- Настройка `user: "${UID:-1000}:${GID:-1000}"` для контейнеров
- Добавление сервиса `tools`
- Настройка volumes с `:cached` для оптимизации

**Out of Scope**:
- Создание helper-скриптов (задача A13)
- Обновление документации (задача A14)
- Настройка production окружения

## Acceptance Criteria

✅ Контейнеры работают от имени пользователя хоста  
✅ Файлы создаются с правильными правами  
✅ Git видит изменения, созданные в контейнере  
✅ IDE может редактировать файлы без проблем

## Implementation Notes

### Изменения в docker-compose.yml

**Сервис `app`:**
- Изменен dockerfile с `Dockerfile` на `Dockerfile.dev`
- Добавлен `user: "${UID:-1000}:${GID:-1000}"` для работы от имени пользователя хоста
- Добавлен `:cached` к volume для оптимизации на macOS
- Добавлена переменная окружения `COMPOSER_HOME=/var/www/html/.composer`

**Новый сервис `tools`:**
- Использует `Dockerfile.tools`
- Настроен `user: "${UID:-1000}:${GID:-1000}"`
- Настроены volumes с `:cached`
- Рабочая директория: `/var/www/html`

### Переменные окружения

Для правильной работы необходимо создать файл `.env` в корне проекта (на основе `.env.example`):
```env
# Docker User/Group IDs для правильных прав доступа
# На Linux/macOS: используйте `id -u` и `id -g` для получения ваших UID/GID
# На Windows (WSL2): также используйте `id -u` и `id -g` в WSL терминале
UID=1000
GID=1000
```

**Примечание**: Файл `.env.example` должен быть создан вручную или через документацию, так как он находится в globalignore.

### Преимущества

1. **Правильные права доступа**: Файлы создаются от имени пользователя хоста, а не root
2. **Git совместимость**: Git корректно видит изменения, созданные в контейнере
3. **IDE совместимость**: IDE может редактировать файлы без проблем с правами
4. **Безопасность**: Контейнеры не работают от root
5. **Изоляция инструментов**: Отдельный контейнер `tools` для инструментов анализа

## Lessons Learned

1. **Права доступа**: Использование `user: "${UID:-1000}:${GID:-1000}"` позволяет контейнерам работать от имени пользователя хоста, что решает проблемы с правами доступа.

2. **Volumes оптимизация**: Использование `:cached` для volumes на macOS улучшает производительность синхронизации файлов.

3. **Разделение сервисов**: Отдельный сервис `tools` позволяет изолировать инструменты анализа от окружения разработки.

4. **Переменные окружения**: Использование переменных окружения для UID/GID делает конфигурацию гибкой и переносимой между разными системами.

## Immediate Next Steps

Следующая задача: **A13: Создать helper-скрипты для разработки** (теперь доступна, так как A12 выполнена).

