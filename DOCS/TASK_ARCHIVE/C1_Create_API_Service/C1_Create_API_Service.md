# Task C1: Создать API сервис (TodoApiService)

**Статус**: Completed ✅  
**Начало**: 2025-01-27  
**Приоритет**: High  
**Оценка**: 1 день

## Описание

Создать API сервис `TodoApiService` для взаимодействия с бэкенд API. Сервис должен предоставлять методы для всех операций с задачами (CRUD).

## Зависимости

- [x] B7: Настроить API routes (Completed ✅)

## Текущее состояние

В `frontend/src/services/api.js` уже есть базовая структура с функцией `getTodos()`.

## Требования

### Цель

Создать полноценный API сервис с методами для:
- Получения списка всех задач
- Создания новой задачи
- Обновления задачи
- Переключения статуса задачи
- Удаления задачи
- Удаления всех выполненных задач

### API Endpoints

1. `GET /api/todos` - получить список всех задач
2. `POST /api/todos` - создать новую задачу
3. `PUT /api/todos/{id}` - обновить задачу
4. `PATCH /api/todos/{id}/status` - переключить статус задачи
5. `DELETE /api/todos/{id}` - удалить задачу
6. `DELETE /api/todos/completed` - удалить все выполненные задачи

## План выполнения

### Шаг 1: Анализ текущего кода
- [x] Проверить существующий `api.js` ✅
- [x] Определить структуру данных ✅
- [x] Определить необходимые методы ✅

### Шаг 2: Реализация методов (TDD: Red-Green-Refactor)
- [x] Реализовать методы API сервиса ✅
- [x] Добавить обработку ошибок ✅

### Шаг 3: Обработка ошибок
- [x] Добавить обработку ошибок сети ✅
- [x] Добавить обработку ошибок валидации (422) ✅
- [x] Добавить обработку ошибок 404 ✅

## Критерии приемки

✅ Все методы API реализованы  
✅ Обработка ошибок работает корректно  
✅ Тесты проходят (TDD: Red-Green-Refactor)  
✅ Сервис готов к использованию в компонентах

## Реализация

### Реализованные методы

1. **getTodos()** - GET запрос к `/api/todos`
   - Возвращает массив всех задач
   - Обрабатывает ошибки сети

2. **createTodo(title)** - POST запрос к `/api/todos`
   - Создает новую задачу с указанным title
   - Обрабатывает ошибки валидации (422)
   - Возвращает созданную задачу

3. **updateTodo(id, title)** - PUT запрос к `/api/todos/{id}`
   - Обновляет задачу с указанным id
   - Обрабатывает ошибки 404 и валидации (422)
   - Возвращает обновленную задачу

4. **toggleStatus(id)** - PATCH запрос к `/api/todos/{id}/status`
   - Переключает статус задачи (active ↔ completed)
   - Не требует body, только id в URL
   - Обрабатывает ошибки 404
   - Возвращает обновленную задачу

5. **deleteTodo(id)** - DELETE запрос к `/api/todos/{id}`
   - Удаляет задачу с указанным id
   - Обрабатывает ошибки 404
   - Возвращает void

6. **deleteCompleted()** - DELETE запрос к `/api/todos/completed`
   - Удаляет все выполненные задачи
   - Возвращает количество удаленных задач

### Обработка ошибок

- ✅ Ошибки сети обрабатываются через проверку `response.ok`
- ✅ Ошибки валидации (422) обрабатываются с извлечением деталей из JSON
- ✅ Ошибки 404 обрабатываются с извлечением сообщения об ошибке
- ✅ Все ошибки выбрасываются как исключения с понятными сообщениями

## Прогресс

Начато: 2025-01-27  
Завершено: 2025-01-27

