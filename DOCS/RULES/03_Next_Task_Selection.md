# Алгоритм выбора следующей задачи

## Цель

Обеспечить контролируемое, зависимо-осознанное продвижение по backlog проекта CoolTodo. Задачи должны выбираться систематически, с учетом приоритетов и зависимостей.

## Шаги выбора задачи

### Шаг 1: Перечислить кандидатов из TODO Workplan

Открой файл `DOCS/AI/Execution_Guide/04_TODO_Workplan.md` и перечисли все задачи со статусом **Open** (готовы к началу).

**Формат**:
```
Кандидаты:
- A1: Инициализировать проект (High, 1d, None)
- A2: Настроить CI пайплайн (High, 1.5d, A1)
- B1: Создать модели данных (High, 2d, A1)
```

### Шаг 2: Фильтровать по готовности (зависимости удовлетворены)

Проверь каждую задачу:

1. **Проверь зависимости**: Все задачи из поля `Dependencies` должны иметь статус **Completed ✅**
2. **Проверь блокировки**: Задача не должна быть в файле `DOCS/INPROGRESS/blocked.md`
3. **Проверь текущую работу**: Задача не должна быть в `DOCS/INPROGRESS/` (кроме завершенных)

**Результат**: Список задач, готовых к выполнению.

### Шаг 3: Приоритизировать

Примени следующую иерархию приоритетов:

1. **По приоритету**: High > Medium > Low
2. **По фазе**: Более ранние фазы (Phase A) имеют приоритет над более поздними (Phase B, C, ...)
3. **По ID**: Если приоритет и фаза одинаковые, выбери задачу с меньшим ID (A1 перед A2)

**Пример**:
```
Приоритет 1: High, Phase A, A1
Приоритет 2: High, Phase A, A2
Приоритет 3: Medium, Phase A, A3
Приоритет 4: High, Phase B, B1
```

### Шаг 4: Проверка на здравый смысл

Перед выбором задачи проверь:

- [ ] Задача не требует внешних ресурсов, которые недоступны
- [ ] Задача не блокирует другие критичные задачи
- [ ] Оценка времени (Effort) разумна для текущей итерации
- [ ] Все необходимые инструменты доступны

**Если задача не проходит проверку**: Отметь ее как **Blocked** в `DOCS/INPROGRESS/blocked.md` и выбери следующую по приоритету.

### Шаг 5: Записать решение в `DOCS/INPROGRESS/`

Создай файл в `DOCS/INPROGRESS/` с названием `[TaskID]_[ShortName].md`:

```markdown
# Task [ID]: [Название задачи]

**Статус**: In Progress
**Начало**: [Дата]
**Приоритет**: [High/Medium/Low]
**Оценка**: [Effort]

## Описание

[Описание задачи из TODO Workplan]

## Зависимости

- [x] Зависимость 1 (Completed)
- [x] Зависимость 2 (Completed)

## План выполнения

- [ ] Шаг 1
- [ ] Шаг 2
- [ ] Шаг 3

## Прогресс

[Отслеживание прогресса выполнения]

## Заметки

[Заметки в процессе работы]
```

## Пример выбора задачи

### Исходные данные

Из `04_TODO_Workplan.md`:
- A1: Инициализировать проект (High, 1d, None) - **Completed ✅**
- A2: Настроить CI пайплайн (High, 1.5d, A1) - **Open**
- B1: Создать модели данных (High, 2d, A1) - **Open**

### Шаг 1: Кандидаты

```
Кандидаты:
- A2: Настроить CI пайплайн (High, 1.5d, A1)
- B1: Создать модели данных (High, 2d, A1)
```

### Шаг 2: Фильтрация

- A2: Зависимость A1 ✅ Completed → **Готова**
- B1: Зависимость A1 ✅ Completed → **Готова**

### Шаг 3: Приоритизация

- A2: High, Phase A, A2
- B1: High, Phase B, B1

**Выбор**: A2 (более ранняя фаза)

### Шаг 4: Проверка здравого смысла

- ✅ A2 не требует внешних ресурсов
- ✅ A2 не блокирует другие задачи
- ✅ Оценка 1.5d разумна
- ✅ GitHub Actions доступен

**Результат**: A2 выбрана для выполнения.

### Шаг 5: Запись решения

Создан файл `DOCS/INPROGRESS/A2_Setup_CI.md` с описанием задачи.

## Обновление статуса задач

### При завершении задачи

1. Обнови статус в `04_TODO_Workplan.md`: **Completed ✅**
2. Перемести файл из `DOCS/INPROGRESS/` в `DOCS/TASK_ARCHIVE/[TaskID]_[TaskName]/`
3. Создай архивную запись с результатами (см. `agent-system-prompt.md`)

### При блокировке задачи

1. Обнови статус в `04_TODO_Workplan.md`: **Blocked**
2. Добавь запись в `DOCS/INPROGRESS/blocked.md`:
   ```markdown
   | Task ID | Description | Blocker | Expected Resolution |
   |---------|-------------|---------|---------------------|
   | B1 | Интеграция с API | Ожидание API ключей | 2025-12-01 |
   ```

## Автоматизация выбора

Для автоматизации можно использовать скрипт:

```bash
#!/bin/bash
# scripts/select_next_task.sh

# 1. Парсинг TODO Workplan
# 2. Фильтрация по зависимостям
# 3. Приоритизация
# 4. Вывод следующей задачи
```

**Примечание**: Скрипт должен быть идемпотентным и возвращать одинаковый результат при одинаковых входных данных.

## Контрольный список

Перед выбором задачи убедись:

- [ ] Прочитан `04_TODO_Workplan.md`
- [ ] Проверены все зависимости
- [ ] Применена приоритизация
- [ ] Выполнена проверка здравого смысла
- [ ] Решение записано в `DOCS/INPROGRESS/`

