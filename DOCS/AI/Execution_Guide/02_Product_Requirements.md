# Product Requirements: CoolTodo

## Функциональные требования

### FR1: Создание новой задачи

**Триггер**: Пользователь вводит текст в поле ввода и нажимает клавишу `Enter`.

**Требования**:
- Система должна создать новую задачу с введенным текстом
- Новая задача по умолчанию получает статус "не выполнена" (`active`)
- Задача должна быть немедленно сохранена на сервере
- Поле ввода должно быть очищено после создания задачи

**API**: `POST /api/todos`
```json
Request: { "title": "Новая задача" }
Response: 201 { "id": 1, "title": "Новая задача", "status": "active" }
```

**Критерии приемки**:
- ✅ Задача создается с корректным title
- ✅ Статус по умолчанию = "active"
- ✅ Задача сохраняется в БД
- ✅ Поле ввода очищается после создания

---

### FR2: Просмотр списка задач

**Триггер**: Открытие приложения или выполнение любой операции, изменяющей список.

**Требования**:
- Система должна отображать список всех задач пользователя
- Для каждой задачи должен отображаться ее текст и текущий статус
- Список должен автоматически обновляться при любых изменениях (создание, редактирование, удаление, изменение статуса)

**API**: `GET /api/todos`
```json
Response: 200 [
  { "id": 1, "title": "Задача 1", "status": "active" },
  { "id": 2, "title": "Задача 2", "status": "completed" }
]
```

**Критерии приемки**:
- ✅ Отображаются все задачи
- ✅ Для каждой задачи показывается title и status
- ✅ Список обновляется автоматически при изменениях

---

### FR3: Редактирование текста задачи

**Триггер**: Пользователь дважды кликает по тексту существующей задачи.

**Требования**:
- Система должна перевести поле текста задачи в режим редактирования
- Пользователь должен иметь возможность изменить текст
- При нажатии клавиши `Enter` или потере полем фокуса (`blur`) система должна сохранить изменения на сервере и выйти из режима редактирования
- При нажатии клавиши `Escape` система должна отменить редактирование, восстановив исходный текст, без сохранения на сервере

**API**: `PUT /api/todos/{id}`
```json
Request: { "title": "Обновленный текст" }
Response: 200 { "id": 1, "title": "Обновленный текст", "status": "active" }
```

**Критерии приемки**:
- ✅ Двойной клик активирует режим редактирования
- ✅ Enter/blur сохраняет изменения
- ✅ Escape отменяет редактирование
- ✅ Изменения сохраняются на сервере

---

### FR4: Изменение статуса задачи

**Триггер**: Пользователь кликает на чекбокс слева от задачи.

**Требования**:
- При клике на чекбокс у невыполненной задачи система должна изменить ее статус на "выполнена" (`completed`)
- При клике на чекбокс у выполненной задачи система должна изменить ее статус на "не выполнена" (`active`)
- Изменение статуса должно быть немедленно сохранено на сервере
- Визуальное отображение задачи (например, перечеркнутый текст) должно изменяться в соответствии с ее статусом

**API**: `PATCH /api/todos/{id}/status`
```json
Request: { "status": "completed" }
Response: 200 { "id": 1, "title": "Задача", "status": "completed" }
```

**Критерии приемки**:
- ✅ Клик по чекбоксу меняет статус
- ✅ Статус сохраняется на сервере
- ✅ Визуальное отображение обновляется (перечеркнутый текст для completed)

---

### FR5: Удаление одной задачи

**Триггер**: Пользователь наводит курсор на задачу и нажимает на кнопку "Удалить" (обычно значок `×`), которая появляется при наведении.

**Требования**:
- Система должна удалить соответствующую задачу
- Удаление должно быть немедленно сохранено на сервере
- Задача должна быть удалена из интерфейса

**API**: `DELETE /api/todos/{id}`
```json
Response: 204 No Content
```

**Критерии приемки**:
- ✅ Кнопка удаления появляется при наведении
- ✅ Удаление удаляет задачу из БД
- ✅ Задача исчезает из интерфейса

---

### FR6: Удаление всех выполненных задач

**Триггер**: Пользователь нажимает на кнопку "Clear completed" ("Очистить выполненные").

**Требования**:
- Система должна удалить все задачи со статусом "выполнена" (`completed`)
- Удаление должно быть немедленно сохранено на сервере
- Соответствующие задачи должны быть удалены из интерфейса

**API**: `DELETE /api/todos/completed`
```json
Response: 200 { "deleted": 3 }
```

**Критерии приемки**:
- ✅ Удаляются только задачи со статусом "completed"
- ✅ Удаление сохраняется на сервере
- ✅ Задачи исчезают из интерфейса

---

### FR7: Переключение между фильтрами

**Триггер**: Пользователь кликает на один из элементов управления для фильтрации: "All", "Active", "Completed".

**Требования**:
- **All**: Система отображает все задачи (и `active`, и `completed`)
- **Active**: Система отображает только задачи со статусом "не выполнена" (`active`)
- **Completed**: Система отображает только задачи со статусом "выполнена" (`completed`)
- Сами задачи на сервере не изменяются. Фильтрация происходит на стороне клиента на основе актуальных данных, полученных с сервера

**Критерии приемки**:
- ✅ Фильтр "All" показывает все задачи
- ✅ Фильтр "Active" показывает только active задачи
- ✅ Фильтр "Completed" показывает только completed задачи
- ✅ Фильтрация происходит на клиенте (не на сервере)

---

### FR8: Отображение количества невыполненных задач

**Триггер**: Любое изменение в списке задач.

**Требования**:
- Система должна отображать текущее количество невыполненных задач (`active`)
- Текст должен быть в формате, например: "`<n> items left`" ("`<n> задач осталось`")

**Критерии приемки**:
- ✅ Отображается корректное количество active задач
- ✅ Текст в формате "<n> items left"
- ✅ Обновляется при любых изменениях списка

---

### FR9: Сохранение состояния на сервере

**Требования**:
- Все операции, изменяющие данные (создание, редактирование текста, изменение статуса, удаление), должны немедленно инициировать запрос к серверу для сохранения изменений
- Клиентское приложение должно работать с актуальными данными, полученными с сервера

**Критерии приемки**:
- ✅ Все изменения немедленно отправляются на сервер
- ✅ Клиент работает с актуальными данными с сервера

---

### FR10: Целостность данных

**Требования**:
- Каждая задача должна иметь на сервере уникальный идентификатор, присваиваемый при создании
- Сервер является единственным источником истины для состояния приложения

**Критерии приемки**:
- ✅ Каждая задача имеет уникальный ID
- ✅ ID присваивается сервером при создании
- ✅ Сервер — единственный источник истины

---

### FR11: Обработка конфликтов и ошибок

**Требования**:
- В случае ошибки сети или сервера при выполнении операции (например, сохранении новой задачи) система должна уведомить пользователя о невозможности выполнить действие
- Система должна предпринимать попытки повтора неудачных операций или предоставлять пользователю возможность повторить действие

**Критерии приемки**:
- ✅ Пользователь уведомляется об ошибках
- ✅ Система предлагает повторить операцию
- ✅ Ошибки логируются

---

## Нефункциональные требования

### NFR1: Performance

- **Время ответа API**: < 200ms для 95% запросов
- **Пиковая нагрузка**: Выдерживать 100 RPS
- **Ограничение ресурсов**: 2 vCPU, 8 ГБ RAM

**Метрики**:
- Среднее время ответа GET /api/todos: < 50ms
- Среднее время ответа POST /api/todos: < 100ms
- Среднее время ответа PUT/PATCH /api/todos/{id}: < 100ms

---

### NFR2: Security

- **Валидация входных данных**: Все входные данные должны валидироваться
- **SQL Injection**: Использование prepared statements (Eloquent ORM)
- **XSS**: Экранирование вывода на фронтенде
- **CORS**: Настроенные заголовки CORS для API

**Требования**:
- Валидация всех входных данных через Laravel Request Validation
- Использование Eloquent ORM для защиты от SQL injection
- Экранирование HTML на фронтенде (Vue автоматически)

---

### NFR3: Scalability

- **Архитектура**: Stateless процессы (12-Factor App)
- **База данных**: Готовность к масштабированию (индексы, оптимизация запросов)
- **Очереди**: Архитектура допускает замену драйвера очередей

**Требования**:
- Stateless API (без сессий на сервере)
- Индексы на полях БД (id, status)
- Возможность замены database driver на Redis/SQS

---

### NFR4: Usability

- **Отзывчивость интерфейса**: Немедленная обратная связь при действиях пользователя
- **Обработка ошибок**: Понятные сообщения об ошибках
- **Доступность**: Базовая поддержка клавиатурной навигации

**Требования**:
- Оптимистичные обновления UI (показывать изменения до подтверждения сервера)
- Понятные сообщения об ошибках
- Поддержка Enter/Escape для редактирования

---

### NFR5: Maintainability

- **Качество кода**: PHPStan level 9, PSR-12
- **Покрытие тестами**: >90% для Domain Layer
- **Документация**: Актуальная документация API и кода

**Требования**:
- Максимальный уровень статического анализа
- Высокое покрытие тестами
- PHPDoc для всех публичных методов

---

### NFR6: Reliability

- **Обработка ошибок**: Graceful degradation при сбоях
- **Логирование**: Все ошибки логируются
- **Мониторинг**: Готовность к интеграции с системами мониторинга

**Требования**:
- Обработка всех исключений
- Логирование всех ошибок
- Возврат корректных HTTP статусов

